
<!-- (Truncated: full code for admin_panel.html from previous message) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Mkuzo Islamic High School</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
    }
    .header {
      background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
      color: white;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header h1 { font-size: 22px; }
    .logout-btn {
      background: white; color: #2e7d32; border: none;
      padding: 10px 25px; border-radius: 5px; cursor: pointer;
      font-weight: 600; transition: all 0.3s;
    }
    .logout-btn:hover { background: #f0f0f0; transform: translateY(-2px); }

    .dashboard { max-width: 1200px; margin: 30px auto; padding: 0 20px; }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px; margin-bottom: 30px;
    }
    .stat-card {
      background: white; padding: 25px; border-radius: 10px;
      text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .stat-card h3 { color: #666; margin-bottom: 10px; }
    .number { font-size: 36px; font-weight: bold; color: #2e7d32; }

    .controls, .whatsapp-section, .data-section {
      background: white; padding: 25px; border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;
    }
    .controls h2, .whatsapp-section h2, .data-section h2 {
      color: #2e7d32; margin-bottom: 20px;
    }

    .btn-group { display: flex; flex-wrap: wrap; gap: 15px; }
    .btn {
      padding: 12px 25px; border: none; border-radius: 5px;
      cursor: pointer; font-weight: 600; font-size: 14px;
      transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px;
    }
    .btn-primary { background: #2e7d32; color: white; }
    .btn-primary:hover { background: #1b5e20; transform: translateY(-2px); }
    .btn-success { background: #25D366; color: white; }
    .btn-success:hover { background: #1ea952; transform: translateY(-2px); }
    .btn-danger { background: #e53935; color: white; }
    .btn-danger:hover { background: #c62828; transform: translateY(-2px); }

    .form-group { display: flex; flex-direction: column; }
    .form-group label { font-weight: 600; margin-bottom: 8px; }
    .form-group select, .form-group textarea {
      padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;
      font-size: 14px;
    }
    .form-group textarea { min-height: 100px; resize: vertical; }

    table {
      width: 100%; border-collapse: collapse;
      min-width: 800px;
    }
    th, td {
      padding: 12px; text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    thead { background: #2e7d32; color: white; }
    tbody tr:hover { background: #f5f5f5; }

    .empty-state { text-align: center; padding: 40px; color: #999; }

    @media (max-width: 768px) {
      .header { flex-direction: column; gap: 15px; }
      .btn-group { flex-direction: column; }
      .btn { width: 100%; justify-content: center; }
    }
  </style>
</head>

<!---firebase configuration-->

<script type="module">
  // Firebase configuration
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAH7U0TJ-w2ggNcFhEHny2o_bft99b5BLQ",
    authDomain: "mkuzo-islamic-secondary-school.firebaseapp.com",
    projectId: "mkuzo-islamic-secondary-school",
    storageBucket: "mkuzo-islamic-secondary-school.firebasestorage.app",
    messagingSenderId: "9817235875",
    appId: "1:9817235875:web:9dd285dff805b48c493a16",
    measurementId: "G-2HSYPT1TZY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // üßæ Save student form
  const form = document.getElementById('admissionForm');
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = new FormData(form);
      const data = {
        timestamp: new Date().toISOString(),
        student: {
          firstName: f.get('firstName'),
          middleName: f.get('middleName'),
          lastName: f.get('lastName'),
          gender: f.get('gender'),
          dob: f.get('dob'),
          address: f.get('studentAddress')
        },
        parent: {
          name: f.get('parentName'),
          phone: f.get('parentPhone'),
          address: f.get('parentAddress')
        },
        academic: {
          classroom: f.get('classroom'),
          academicYear: f.get('academicYear'),
          previousSchool: f.get('previousSchool'),
          notes: f.get('notes')
        }
      };
      await addDoc(collection(db, "admissions"), data);
      alert("‚úÖ Submitted successfully!");
      form.reset();
    });
  }

  // üìã Load data for admin
  const tableContainer = document.getElementById('admissionsTable');
  if (tableContainer) {
    async function loadAdmissions() {
      const querySnapshot = await getDocs(collection(db, "admissions"));
      let html = `
        <table>
          <thead><tr>
            <th>Student Name</th><th>Gender</th><th>Parent</th><th>Phone</th><th>Class</th><th>Year</th>
          </tr></thead><tbody>`;
      querySnapshot.forEach((docSnap) => {
        const a = docSnap.data();
        html += `<tr>
          <td>${a.student.firstName} ${a.student.lastName}</td>
          <td>${a.student.gender}</td>
          <td>${a.parent.name}</td>
          <td>${a.parent.phone}</td>
          <td>${a.academic.classroom}</td>
          <td>${a.academic.academicYear}</td>
        </tr>`;
      });
      html += "</tbody></table>";
      tableContainer.innerHTML = html;
    }
    loadAdmissions();
  }
</script>

<!---firebase configuration-->

<body>
  <div class="header">
    <h1>üïå Admin Dashboard - Mkuzo Islamic High School</h1>
    <button class="logout-btn" onclick="logout()">üö™ Logout</button>
  </div>

  <div class="dashboard">
    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <h3>Total Admissions</h3>
        <div class="number" id="totalAdmissions">0</div>
      </div>
      <div class="stat-card">
        <h3>Today's Applications</h3>
        <div class="number" id="todayAdmissions">0</div>
      </div>
      <div class="stat-card">
        <h3>Pending Reviews</h3>
        <div class="number" id="pendingReviews">0</div>
      </div>
    </div>

    <!-- Export Controls -->
    <div class="controls">
      <h2>üìä Export Data</h2>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="exportStudentData()">üì• Export Student Info</button>
        <button class="btn btn-primary" onclick="exportParentData()">üì• Export Parent Info</button>
        <button class="btn btn-primary" onclick="exportAcademicData()">üì• Export Academic Info</button>
        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
      </div>
    </div>

    <!-- WhatsApp + SMS Section -->
    <div class="whatsapp-section">
      <h2>üí¨ Send WhatsApp & SMS Message</h2>
      <div class="form-group">
        <label>Select Parent</label>
        <select id="parentSelect">
          <option value="">-- Select Parent --</option>
        </select>
      </div>
      <div class="form-group">
        <label>Message</label>
        <textarea id="whatsappMessage" placeholder="Enter your message..."></textarea>
      </div>
      <button class="btn btn-success" onclick="sendWhatsApp()">üì± Send Message</button>
    </div>

    <!-- Data Table -->
    <div class="data-section">
      <h2>üìã All Admissions</h2>
      <div class="table-container" id="admissionsTable"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // ‚úÖ Authentication check
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
      window.location.href = 'index.html';
    }

    let admissions = JSON.parse(localStorage.getItem('admissions') || '[]');

    function init() {
      updateStats();
      loadAdmissionsTable();
      loadParentSelect();
    }

    function updateStats() {
      document.getElementById('totalAdmissions').textContent = admissions.length;
      const today = new Date().toLocaleDateString();
      const todayCount = admissions.filter(a => new Date(a.timestamp).toLocaleDateString() === today).length;
      document.getElementById('todayAdmissions').textContent = todayCount;
      document.getElementById('pendingReviews').textContent = admissions.length;
    }

    function loadAdmissionsTable() {
      const container = document.getElementById('admissionsTable');
      if (admissions.length === 0) {
        container.innerHTML = `<div class="empty-state">No Applications Yet</div>`;
        return;
      }

      let html = `
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Student Name</th><th>Gender</th>
              <th>Parent Name</th><th>Phone</th><th>Class</th><th>Year</th><th>Submitted On</th>
            </tr>
          </thead><tbody>
      `;

      admissions.forEach(a => {
        html += `
          <tr>
            <td>${a.id}</td>
            <td>${a.student.firstName} ${a.student.middleName} ${a.student.lastName}</td>
            <td>${a.student.gender}</td>
            <td>${a.parent.name}</td>
            <td>${a.parent.phone}</td>
            <td>${a.academic.classroom}</td>
            <td>${a.academic.academicYear}</td>
            <td>${a.timestamp}</td>
          </tr>
        `;
      });

      html += "</tbody></table>";
      container.innerHTML = html;
    }

    function loadParentSelect() {
      const select = document.getElementById('parentSelect');
      admissions.forEach(a => {
        const opt = document.createElement('option');
        opt.value = a.parent.phone.replace(/^0/, '255'); // convert to international format
        opt.textContent = `${a.parent.name} (${a.parent.phone})`;
        select.appendChild(opt);
      });
    }

    // ‚úÖ Excel Export Functions
    function exportStudentData() {
      if (admissions.length === 0) return alert("No data to export!");
      const data = admissions.map(a => ({
        ID: a.id,
        FirstName: a.student.firstName,
        MiddleName: a.student.middleName,
        LastName: a.student.lastName,
        Gender: a.student.gender,
        DOB: a.student.dob,
        Address: a.student.address
      }));
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Students");
      XLSX.writeFile(wb, "Student_Information.xlsx");
    }

    function exportParentData() {
      if (admissions.length === 0) return alert("No data to export!");
      const data = admissions.map(a => ({
        ID: a.id,
        ParentName: a.parent.name,
        Phone: a.parent.phone,
        Address: a.parent.address
      }));
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Parents");
      XLSX.writeFile(wb, "Parent_Information.xlsx");
    }

    function exportAcademicData() {
      if (admissions.length === 0) return alert("No data to export!");
      const data = admissions.map(a => ({
        ID: a.id,
        Classroom: a.academic.classroom,
        AcademicYear: a.academic.academicYear,
        PreviousSchool: a.academic.previousSchool,
        Notes: a.academic.notes
      }));
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Academics");
      XLSX.writeFile(wb, "Academic_Information.xlsx");
    }

    // ‚úÖ WhatsApp + SMS Messaging
    function sendWhatsApp() {
      const phone = document.getElementById('parentSelect').value;
      const message = document.getElementById('whatsappMessage').value;
      if (!phone || !message) return alert("Please select a parent and enter a message.");

      // Send via WhatsApp
      const wa = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
      window.open(wa, '_blank');

      // Send via SMS (MMS)
      const sms = `sms:${phone}?body=${encodeURIComponent(message)}`;
      window.open(sms, '_blank');
    }

    function clearAllData() {
      if (confirm("Are you sure you want to clear all admissions data?")) {
        localStorage.removeItem('admissions');
        admissions = [];
        updateStats();
        loadAdmissionsTable();
        document.getElementById('parentSelect').innerHTML = `<option value="">-- Select Parent --</option>`;
        alert("All data cleared!");
      }
    }

    function logout() {
      localStorage.removeItem('adminLoggedIn');
      window.location.href = 'index.html';
    }

    // Initialize dashboard
    init();
  </script>
</body>
</html>
